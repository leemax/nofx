# Web Dashboard Changelog

## v2.2 - 动态提示词管理与工作流优化

### ✨ 新功能：动态提示词管理

- **后端**：
  - ✅ **文件加载**：系统现在从 `/prompts` 目录动态加载所有 `.txt` 格式的提示词文件。
  - ✅ **API扩展**：新增 `GET /api/prompts` 接口，用于向前端提供所有可用的提示词列表及在 `config.json` 中配置的默认提示词ID。
  - ✅ **手动决策**：新增 `POST /api/force-decision` 接口，允许通过前端手动触发一次指定提示词的决策周期。

- **前端**：
  - ✅ **提示词选择器**：在页面头部添加了一个下拉菜单，允许用户在不同的AI决策提示词之间自由切换。
  - ✅ **状态持久化**：用户选择的提示词在页面刷新后将保持选中状态，解决了之前刷新后重置为默认值的问题。
  - ✅ **强制决策按钮**：UI上增加了“Force Decision”按钮，方便用户立即使用选定的提示词进行决策。

### 🛠️ 工作流与Bug修复

- ✅ **AI模型更新**：将DeepSeek的默认模型从 `deepseek-chat` 更新为 `deepseek-reasoner`，以期获得更强的推理能力。
- ✅ **工作流文档**：在项目根目录创建了 `WORKFLOW.md`，明确了项目的迭代规范，特别是迭代结束后的 `CHANGELOG.md` 更新和Git提交要求。
- ✅ **后端编译修复**：修复了多个Go语言的编译错误，包括 `syntax error`, `err redeclared`, 和 `undefined: config`，确保了后端服务的稳定性。
- ✅ **AI决策解析修复**：通过优化 `Grok.txt` 提示词中的指令，解决了AI返回的JSON格式错误（如 `invalid action`, `invalid confidence`, `invalid JSON format`），提高了决策成功率。

---

**更新日期**: 2025-11-04

## v2.1 - 盈亏计算口径统一与AI学习分析优化

### 📈 功能改进

#### 盈亏计算统一
- ✅ **币种表现**：Total P&L (USDT) 现在反映扣除手续费后的净利润，与已平仓交易数据保持一致。
- ✅ **已平仓交易**：新增“已平仓交易”表格，替换旧的“历史成交”表格，展示每笔平仓交易的净利润、总手续费、开仓/平仓均价等详细信息。

#### AI学习分析优化
- ✅ **后端重构**：重构了后端性能分析逻辑，将Position Matcher和Performance Analyzer模块化，并移至decision包，解决了循环依赖问题。
- ✅ **夏普比率**：AI学习分析中现在包含夏普比率（Sharpe Ratio）计算，作为风险调整后收益的关键指标。

### 🛠️ 技术优化

- ✅ **模块化**：将Position Matcher和Performance Analyzer从manager包移动到decision包，增强了代码的模块化和可维护性。
- ✅ **依赖管理**：解决了Go模块间的循环依赖问题。
- ✅ **代码清理**：移除了logger包中不再使用的AnalyzePerformance函数和Statistics结构体。

---

**更新日期**: 2025-11-04

## v2.0 - 重大UI升级（参考nof0设计）

### 🎨 样式改进

#### 配色方案
- ✅ 采用nof0项目的极简黑白灰配色
- ✅ **主色调**：
  - 纯黑背景 `#0a0a0a`
  - 白色文字 `#ededed`
  - 灰色边框 `rgba(255, 255, 255, 0.1)`
  - 品牌色仅用于AI提供商标识（DeepSeek蓝 `#4d6bfe`、Qwen紫 `#8b5cf6`）
- ✅ **字体**：IBM Plex Mono（等宽字体，专业交易界面风格）
- ✅ **终端扫描线效果**：灰色扫描线动画，营造专业交易氛围

#### UI组件升级
- ✅ **Header**：
  - 纯白色标题文字
  - 玻璃态模糊背景（glass effect）
  - 粘性定位（sticky top）
  - 状态指示器带脉冲发光动画
  - AI提供商颜色区分（DeepSeek蓝/Qwen紫）

- ✅ **统计卡片**：
  - 半透明背景 `bg-gray-900/50`
  - Hover时边框高亮效果
  - 等宽字体显示数字
  - 大写字母标题，增加专业感

- ✅ **通用效果**：
  - 淡入动画（animate-fade-in）
  - 平滑过渡效果
  - 自定义滚动条样式
  - 按钮悬停效果

### 📊 新功能：账户收益率曲线

#### 后端API
- ✅ 新增 `GET /api/equity-history` 端点
- ✅ 返回最近30个周期的账户净值数据
- ✅ 包含时间戳、净值、盈亏、周期号

#### 前端图表组件（EquityChart）
- ✅ **双显示模式**：
  - 美元模式：显示绝对金额
  - 百分比模式：显示收益率百分比
  - 一键切换

- ✅ **图表特性**：
  - 使用Recharts库
  - 白灰渐变线条（极简风格）
  - 参考线显示初始余额/0%
  - 自定义Tooltip（显示详细信息）
  - 响应式布局，自适应容器宽度

- ✅ **数据展示**：
  - 实时当前净值和总盈亏
  - 初始余额对比
  - 数据点数量统计
  - 每10秒自动刷新

### 📝 组件结构

```
web/src/
├── components/
│   └── EquityChart.tsx         # 收益率曲线图表
├── lib/
│   └── api.ts                  # 新增getEquityHistory()
├── index.css                   # 全新样式系统
└── App.tsx                     # 集成图表组件
```

### 🎯 视觉改进对比

**Before:**
- 基础Tailwind深色主题
- 简单卡片布局
- 灰色单调配色
- 无曲线图表

**After:**
- nof0风格极简黑白灰配色
- 终端扫描线效果
- 纯白文字和灰色主题
- 实时收益率曲线
- IBM Plex Mono字体
- 玻璃态和动画效果

### 🚀 性能优化

- SWR数据缓存和自动刷新
- 组件级代码分割
- 响应式设计优化
- 图表数据自动降采样

### 📱 响应式设计

- 移动端优化布局
- 平板/桌面端多列展示
- 图表自适应容器宽度
- 触摸友好的交互

### 🔧 技术栈

- React 18
- TypeScript
- Vite
- Tailwind CSS
- Recharts
- SWR
- IBM Plex Mono字体

---

**更新日期**: 2025-10-27
